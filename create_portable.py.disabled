"""
Coldhawk í¬í„°ë¸” ë²„ì „ ìƒì„±ê¸°
exe íŒŒì¼ê³¼ í™˜ê²½ë³€ìˆ˜ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ë¥¼ í•¨ê»˜ íŒ¨í‚¤ì§•
"""
import os
import shutil
import zipfile
from pathlib import Path

def create_portable_package():
    """í¬í„°ë¸” íŒ¨í‚¤ì§€ ìƒì„±"""
    print("ColdHawk_test.ver1 í¬í„°ë¸” ë²„ì „ ìƒì„± ì¤‘...")
    
    # í¬í„°ë¸” í´ë” ìƒì„±
    portable_dir = Path("ColdHawk_test.ver1_Portable")
    if portable_dir.exists():
        shutil.rmtree(portable_dir)
    portable_dir.mkdir()
    
    # exe íŒŒì¼ ë³µì‚¬
    exe_path = Path("dist/ColdHawk_test.ver1.exe")
    if exe_path.exists():
        shutil.copy2(exe_path, portable_dir / "ColdHawk_test.ver1.exe")
        print("ColdHawk_test.ver1.exe ë³µì‚¬ ì™„ë£Œ")
    else:
        print("ColdHawk_test.ver1.exeë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¹Œë“œí•´ì£¼ì„¸ìš”.")
        return
    
    # ë¦¬ì†ŒìŠ¤ íŒŒì¼ ë³µì‚¬
    resources_dir = portable_dir / "resources"
    if Path("resources").exists():
        shutil.copytree("resources", resources_dir)
        print("ë¦¬ì†ŒìŠ¤ íŒŒì¼ ë³µì‚¬ ì™„ë£Œ")
    
    # ìŠ¤íƒ€ì¼ íŒŒì¼ ë³µì‚¬
    styles_dir = portable_dir / "ui" / "styles"
    if Path("ui/styles").exists():
        styles_dir.parent.mkdir(parents=True, exist_ok=True)
        shutil.copytree("ui/styles", styles_dir)
        print("ìŠ¤íƒ€ì¼ íŒŒì¼ ë³µì‚¬ ì™„ë£Œ")
    
    # í™˜ê²½ë³€ìˆ˜ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
    create_setup_scripts(portable_dir)
    
    # ì‚¬ìš©ì ê°€ì´ë“œ ìƒì„±
    create_user_guide(portable_dir)
    
    # ZIP íŒŒì¼ ìƒì„±
    create_zip_package(portable_dir)
    
    print(f"\ní¬í„°ë¸” ë²„ì „ ìƒì„± ì™„ë£Œ!")
    print(f"ìœ„ì¹˜: {portable_dir.absolute()}")
    print(f"ZIP: Coldhawk_Portable.zip")

def create_setup_scripts(portable_dir):
    """í™˜ê²½ë³€ìˆ˜ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ìƒì„±"""
    
    # Windows ë°°ì¹˜ íŒŒì¼
    setup_bat = portable_dir / "ì„¤ì •.bat"
    with open(setup_bat, 'w', encoding='utf-8') as f:
        f.write("""@echo off
chcp 65001 >nul
echo ========================================
echo ColdHawk_test.ver1 í™˜ê²½ë³€ìˆ˜ ì„¤ì •
echo ========================================
echo.

echo Firebase í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤...
setx FIREBASE_API_KEY "AIzaSyAo2-_VoDQsNjRCimzns5V6boc6-ajP8zs" >nul 2>&1
setx FIREBASE_AUTH_DOMAIN "coldhawk-id.firebaseapp.com" >nul 2>&1
setx FIREBASE_DATABASE_URL "https://coldhawk-id.firebaseio.com" >nul 2>&1
setx FIREBASE_STORAGE_BUCKET "coldhawk-id.appspot.com" >nul 2>&1

echo âœ… í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ!
echo.
echo âš ï¸  ìƒˆë¡œìš´ ëª…ë ¹ í”„ë¡¬í”„íŠ¸ë¥¼ ì—´ê³  ColdHawk_test.ver1.exeë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.
echo.
pause
""")
    
    # ì‹¤í–‰ìš© ë°°ì¹˜ íŒŒì¼
    run_bat = portable_dir / "Coldhawk_ì‹¤í–‰.bat"
    with open(run_bat, 'w', encoding='utf-8') as f:
        f.write("""@echo off
chcp 65001 >nul

REM í™˜ê²½ë³€ìˆ˜ ì„ì‹œ ì„¤ì •
set FIREBASE_API_KEY=AIzaSyAo2-_VoDQsNjRCimzns5V6boc6-ajP8zs
set FIREBASE_AUTH_DOMAIN=coldhawk-id.firebaseapp.com
set FIREBASE_DATABASE_URL=https://coldhawk-id.firebaseio.com
set FIREBASE_STORAGE_BUCKET=coldhawk-id.appspot.com

REM Coldhawk ì‹¤í–‰
echo ColdHawk_test.ver1ì„ ì‹œì‘í•©ë‹ˆë‹¤...
start "" "ColdHawk_test.ver1.exe"
""")
    
    print("í™˜ê²½ë³€ìˆ˜ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ")

def create_user_guide(portable_dir):
    """ì‚¬ìš©ì ê°€ì´ë“œ ìƒì„±"""
    guide_path = portable_dir / "ì‚¬ìš©ë²•.txt"
    with open(guide_path, 'w', encoding='utf-8') as f:
        f.write("""ğŸš€ ColdHawk_test.ver1 í¬í„°ë¸” ë²„ì „ ì‚¬ìš©ë²•

ğŸ“‹ ì²˜ìŒ ì‚¬ìš©í•˜ì‹œëŠ” ê²½ìš°:
1. "ì„¤ì •.bat" íŒŒì¼ì„ ì‹¤í–‰í•˜ì„¸ìš”
2. ìƒˆë¡œìš´ ëª…ë ¹ í”„ë¡¬í”„íŠ¸ë¥¼ ì—¬ì„¸ìš”
3. "Coldhawk.exe"ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”

ğŸš€ ë¹ ë¥¸ ì‹¤í–‰:
- "ColdHawk_test.ver1_ì‹¤í–‰.bat" íŒŒì¼ì„ ë”ë¸”í´ë¦­í•˜ì„¸ìš”
- (í™˜ê²½ë³€ìˆ˜ë¥¼ ë§¤ë²ˆ ì„ì‹œ ì„¤ì •í•©ë‹ˆë‹¤)

ğŸ”‘ ë¡œê·¸ì¸:
- Firebase ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”
- ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”

ğŸ“ íŒŒì¼ êµ¬ì„±:
- ColdHawk_test.ver1.exe: ë©”ì¸ í”„ë¡œê·¸ë¨
- ì„¤ì •.bat: í™˜ê²½ë³€ìˆ˜ ì˜êµ¬ ì„¤ì •
- Coldhawk_ì‹¤í–‰.bat: ë¹ ë¥¸ ì‹¤í–‰
- resources/: í”„ë¡œê·¸ë¨ ë¦¬ì†ŒìŠ¤
- ui/styles/: í”„ë¡œê·¸ë¨ ìŠ¤íƒ€ì¼

â“ ë¬¸ì œ í•´ê²°:
- ë¡œê·¸ì¸ ì˜¤ë¥˜ê°€ ë‚˜ë©´ "ì„¤ì •.bat"ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”
- ì»´í“¨í„°ë¥¼ ì¬ì‹œì‘í•´ë³´ì„¸ìš”
- ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•´ë³´ì„¸ìš”

ğŸ‰ ì¦ê±°ìš´ ì‚¬ìš© ë˜ì„¸ìš”!
""")
    
    print("ì‚¬ìš©ì ê°€ì´ë“œ ìƒì„± ì™„ë£Œ")

def create_zip_package(portable_dir):
    """ZIP íŒ¨í‚¤ì§€ ìƒì„±"""
    zip_path = "ColdHawk_test.ver1_Portable.zip"
    if Path(zip_path).exists():
        Path(zip_path).unlink()
    
    with zipfile.ZipFile(zip_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
        for root, dirs, files in os.walk(portable_dir):
            for file in files:
                file_path = Path(root) / file
                arc_path = file_path.relative_to(portable_dir.parent)
                zipf.write(file_path, arc_path)
    
    print("ZIP íŒ¨í‚¤ì§€ ìƒì„± ì™„ë£Œ")

if __name__ == "__main__":
    create_portable_package()
